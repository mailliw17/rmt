(function(e,t,o,n){"use strict";function i(t,o){return V=this,this.element=t,L=t,this.options=e.extend({},Z,o),this._defaults=Z,this._name=T,this}function a(){var e=E();try{U.getUserMedia(e).then(l).catch(function(e){return V.options.cameraError(e),!1})}catch(e){return V.options.getUserMediaError(e),!1}return!0}function r(){if(!j){G||a();const e=W.play();e&&"undefined"!=typeof Promise&&e instanceof Promise&&e.catch(e=>null),u()}}function s(){_=!0;const e=W.pause();if(e&&"undefined"!=typeof Promise&&e instanceof Promise&&e.catch(e=>null),W.streamSrc(null),F.clearRect(0,0,z,A),G)for(var t=0;t<G.getTracks().length;t++)G.getTracks()[t].stop();G=null}function c(){_=!0;const e=W.pause();e&&"undefined"!=typeof Promise&&e instanceof Promise&&e.catch(e=>null)}function u(){_=!0,j||setTimeout(function(){_=!1,V.options.decodeBarCodeRate&&h(),V.options.decodeQRCodeRate&&g()},V.options.successTimeout)}function d(){V.options.beep&&O.play()}function l(e){G=e,W.streamSrc(e),V.options.cameraSuccess(e)}function p(){e(W).on("canplay",function(t){q||(W.videoWidth>0&&(A=W.videoHeight/(W.videoWidth/z)),e(L).attr("width",z),e(L).attr("height",A),q=!0,(V.options.decodeQRCodeRate||V.options.decodeBarCodeRate)&&u())}),e(W).on("play",function(){setInterval(function(){if(!W.paused&&!W.ended){var e=V.options.zoom;0===e&&(e=m()),F.drawImage(W,(z*e-z)/-2,(A*e-A)/-2,z*e,A*e);var t=F.getImageData(0,0,z,A);V.options.grayScale&&(t=R(t)),(0!==V.options.brightness||V.options.autoBrightnessValue)&&(t=y(t,V.options.brightness)),0!==V.options.contrast&&(t=w(t,V.options.contrast)),0!==V.options.threshold&&(t=C(t,V.options.threshold)),0!==V.options.sharpness.length&&(t=I(t,V.options.sharpness)),F.putImageData(t,0,0)}},1e3/V.options.frameRate)})}function f(){P.onmessage=function(e){(j||!_&&!W.paused)&&(!0===e.data.success&&"localization"!=e.data.success&&(Q=!0,_=!0,u(),setTimeout(function(){(V.options.codeRepetition||B!=e.data.result[0].Value)&&(d(),B=e.data.result[0].Value,V.options.resultFunction({format:e.data.result[0].Format,code:e.data.result[0].Value,imgData:H}))},0)),Q&&j||"localization"==e.data.success||j||setTimeout(h,1e3/V.options.decodeBarCodeRate))},qrcode.callback=function(e){(j||!_&&!W.paused)&&(Q=!0,_=!0,u(),setTimeout(function(){(V.options.codeRepetition||B!=e)&&(d(),B=e,V.options.resultFunction({format:"QR Code",code:e,imgData:H}))},0))}}function h(){e(L).css({transform:"scale("+(V.options.flipHorizontal?"-1":"1")+", "+(V.options.flipVertical?"-1":"1")+")"}),V.options.tryVertical&&!j?(N.push(N[0]),N.splice(0,1)):N=[1,3,6,8],H=L.toDataURL(),P.postMessage({scan:F.getImageData(0,0,z,A).data,scanWidth:z,scanHeight:A,multiple:!1,decodeFormats:["Code128","Code93","Code39","EAN-13","2Of5","Inter2Of5","Codabar"],rotation:N[0]})}function g(){e(L).css({transform:"scale("+(V.options.flipHorizontal?"-1":"1")+", "+(V.options.flipVertical?"-1":"1")+")"});try{H=L.toDataURL(),qrcode.decode()}catch(e){j||_||setTimeout(g,1e3/V.options.decodeQRCodeRate)}}function m(){return W.videoHeight/A}function v(){for(var e,t,o,n,i=F.getImageData(0,0,z,A),a=i.data,r=0,s=0,c=a.length;s<c;s+=4)e=a[s],t=a[s+1],o=a[s+2],n=Math.floor((e+t+o)/3),r+=n;return Math.floor(r/(z*A))}function y(e,t){t=0===t&&V.options.autoBrightnessValue?V.options.autoBrightnessValue-v():t;for(var o=e.data,n=0;n<o.length;n+=4)o[n]+=t,o[n+1]+=t,o[n+2]+=t;return e}function R(e){for(var t=e.data,o=0;o<t.length;o+=4){var n=t[o],i=t[o+1],a=t[o+2],r=.2126*n+.7152*i+.0722*a;t[o]=t[o+1]=t[o+2]=r}return e}function w(e,t){for(var o=e.data,n=259*(t+255)/(255*(259-t)),i=0;i<o.length;i+=4)o[i]=n*(o[i]-128)+128,o[i+1]=n*(o[i+1]-128)+128,o[i+2]=n*(o[i+2]-128)+128;return e}function C(e,t){for(var o,n=e.data,i=0,a=z*A*4;i<a;i+=4)o=n[i]+n[i+1]+n[i+2],n[i]=n[i+1]=n[i+2]=o<t?0:255,n[i+3]=255;return e}function I(e,t,n){for(var i=e.width,a=e.height,r=i,s=a,c=Math.round(Math.sqrt(t.length)),u=Math.floor(c/2),d=e.data,l=o.createElement("canvas"),p=l.getContext("2d"),f=p.createImageData(r,s),h=f.data,g=n?1:0,m=0;m<s;m++)for(var v=0;v<r;v++){for(var y=m,R=v,w=0,C=0,I=0,b=0,D=4*(m*r+v),E=0;E<c;E++)for(var M=0;M<c;M++){var S=y+E-u,k=R+M-u;if(S>=0&&S<a&&k>=0&&k<i){var T=4*(S*i+k),U=t[E*c+M];w+=d[T]*U,C+=d[T+1]*U,I+=d[T+2]*U,b+=d[T+3]*U}}h[D]=w,h[D+1]=C,h[D+2]=I,h[D+3]=b+g*(255-b)}return f}function b(t,o){x=e(t),x.html("");try{if(U&&U.enumerateDevices)U.enumerateDevices().then(function(t){t.forEach(function(e){D(e)}),"string"==typeof o?Array.prototype.find.call(x.get(0).children,function(t,n){e(t).text().toLowerCase().match(new RegExp(o,"g"))&&x.prop("selectedIndex",n)}):x.prop("selectedIndex",x.children().length<=o?0:o)}).catch(function(e){V.options.getDevicesError(e)});else{if(!U||U.enumerateDevices)throw new k("getUserMedia is Not supported");e('<option value="true">On</option>').appendTo(x),V.options.getDevicesError(new k("enumerateDevices Or getSources is Not supported"))}}catch(e){V.options.getDevicesError(e)}}function D(t){if("video"===t.kind||"videoinput"===t.kind){var o=t.facing&&""!==t.facing?t.facing:"unknown",n=t.label||"Camera ".concat(x.children().length+1," (facing: "+o+")");e('<option value="'+(t.id||t.deviceId)+'">'+n+"</option>").appendTo(x)}}function E(){var t=e.parseJSON(JSON.stringify(V.options.constraints));if(x&&0!==x.children().length)switch(x.val().toString()){case"true":-1==navigator.userAgent.search("Edge")&&-1!=navigator.userAgent.search("Chrome")?t.video.optional=[{sourceId:!0}]:t.video.deviceId=n;break;case"false":t.video=!1;break;default:-1==navigator.userAgent.search("Edge")&&-1!=navigator.userAgent.search("Chrome")?t.video.optional=[{sourceId:x.val()}]:-1!=navigator.userAgent.search("Firefox")?t.video.deviceId={exact:x.val()}:t.video.deviceId=x.val()}return t.audio=!1,t}function M(e){s(),j=!0,Q=!1;var t=new Image;t.onload=function(){F.fillStyle="#fff",F.fillRect(0,0,z,A),F.drawImage(this,5,5,z-10,A-10),g(),h()},e?(S("temp",e),M()):FileReaderHelper?(new FileReaderHelper).Init("jpg|png|jpeg|gif","dataURL",function(e){t.src=e.data},!0):alert("fileReader class not found!")}function S(t,o){var n=e("<a>");n.attr("href",o),n.attr("download",t),n.css("display","none"),n.appendTo("body"),n.click(),n.remove()}function k(e){this.name="NotSupportError",this.message=e||""}var T="WebCodeCamJQuery",U=t.navigator.mediaDevices;U.getUserMedia=function(e){return new Promise(function(o,n){(t.navigator.getUserMedia||t.navigator.mozGetUserMedia||t.navigator.webkitGetUserMedia).call(navigator,e,o,n)})},HTMLVideoElement.prototype.streamSrc="srcObject"in HTMLVideoElement.prototype?function(e){this.srcObject=e||null}:function(e){e?this.src=(t.URL||t.webkitURL).createObjectURL(e):this.removeAttribute("src")};var V,L,x,H,F,O,z,A,B,P=null,W=e("<video muted autoplay playsinline></video>")[0],Q=!1,j=!1,N=[1,3,6,8],q=!1,_=!1,J=!1,G=null,Z={decodeQRCodeRate:5,decodeBarCodeRate:3,successTimeout:500,codeRepetition:!0,tryVertical:!0,frameRate:15,width:320,height:240,constraints:{video:{mandatory:{maxWidth:1280,maxHeight:720},optional:[{sourceId:!0}]},audio:!1},flipVertical:!1,flipHorizontal:!1,zoom:0,decoderWorker:"DecoderWorker.js",brightness:0,autoBrightnessValue:0,grayScale:0,contrast:0,threshold:0,sharpness:[],resultFunction:function(e){console.log(e.format+": "+e.code)},cameraSuccess:function(e){console.log("cameraSuccess")},canPlayFunction:function(){console.log("canPlayFunction")},getDevicesError:function(e){console.log(e)},getUserMediaError:function(e){console.log(e)},cameraError:function(e){console.log(e)}};k.prototype=Error.prototype,e.extend(i.prototype,{init:function(){if(!J){if(!L||"canvas"!==L.tagName.toLowerCase())return console.log("Element type must be canvas!"),alert("Element type must be canvas!"),!1;F=L.getContext("2d"),L.width=z=V.options.width,L.height=A=V.options.height,qrcode.sourceCanvas=L,J=!0,p(),P=new Worker(this.options.decoderWorker),this.options.beep&&(O=new Audio(this.options.beep)),(this.options.decodeQRCodeRate||this.options.decodeBarCodeRate)&&f()}return this},play:function(){return this.init(),j=!1,setTimeout(r,100),this},stop:function(){return s(),this},pause:function(){return c(),this},buildSelectMenu:function(e,t){return b(e,t||0),this},getOptimalZoom:function(){return m()},getLastImageSrc:function(){return L.toDataURL()},decodeLocalImage:function(e){M(e)},isInitialized:function(){return J}}),e.fn[T]=function(t){return this.each(function(){e.data(this,"plugin_"+T)||e.data(this,"plugin_"+T,new i(this,t))})}})(jQuery,window,document);